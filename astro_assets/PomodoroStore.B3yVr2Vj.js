const m="state_pomodoro",S=()=>{try{const e=localStorage.getItem(m);return e===null?null:JSON.parse(e)}catch(e){return console.error("Failed to read from localStorage:",e),null}},p=e=>{try{localStorage.setItem(m,JSON.stringify(e))}catch{console.error("Failed to save to localStorage:",error)}},_=(e,t)=>{document.querySelectorAll(e).forEach(o=>{o.addEventListener("keydown",n=>{(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),o.checked=!0)})}),document.querySelectorAll(t).forEach(o=>{o.addEventListener("keydown",n=>{if(n.key==="Enter"||n.key===" "){n.preventDefault();const r=o.getAttribute("for");if(!r)return;const i=document.getElementById(r);i&&(i.checked=!0,i.focus())}})})},k=(e,t,o)=>{const n=document.querySelector(e);n&&(t==="value"?n.value=o:t==="checked"&&(n.checked=o))},I=e=>{document.querySelectorAll(e).forEach(t=>{t.addEventListener("input",()=>{let o=t.value.replace(/[^\d]/g,"");o.length>1&&(o=o.replace(/^0+/,"")),t.value=o})})},l=e=>new Promise((t,o)=>{const n=new Audio(e);n.addEventListener("canplaythrough",()=>t(n),{once:!0}),n.addEventListener("error",r=>o(r),{once:!0})}),N=async e=>{const[t,o,n,r]=await Promise.all([l(`${e}assets/sounds/start.mp3`),l(`${e}assets/sounds/pause.mp3`),l(`${e}assets/sounds/break.mp3`),l(`${e}assets/sounds/end.mp3`)]);return{startSound:t,pauseSound:o,breakSound:n,endSound:r}},L=(e,t)=>{e&&e[t]&&(e[t].currentTime=0,e[t].play().then(()=>{setTimeout(()=>{e[t].pause(),e[t].currentTime=0},5e3)}).catch(o=>console.warn(`Playback failed: ${o}`)))},O={POMODORO:"pomodoro",SHORT_BREAK:"short-break",LONG_BREAK:"long-break"},U={pomodoro:{time:"timePomodoro"},"short-break":{time:"timeShortBreak"},"long-break":{time:"timeLongBreak"}},T=4,b={START:"startSound",PAUSE:"pauseSound",BREAK:"breakSound",END:"endSound"},c={timePomodoro:25,timeShortBreak:5,timeLongBreak:15,font:"--ff-space",color:"--clr-purple-400",letterSpacing:"--ff-space",pomodoroMode:O.POMODORO,countPomodoro:0,totalDuration:25*60,timeRemaining:25*60,breakTime:0,isRunning:!1},a=Object.freeze({UPDATE_MODE:"UPDATE_MODE",APPLY:"APPLY_SETTINGS",INCREASE_COUNT_POMODORO:"INCREASE_COUNT_POMODORO",MAX_COUNT_POMODORO:"MAX_COUNT_POMODORO",START:"START",PAUSE:"PAUSE",STOP:"STOP",UPDATE_TIMER:"UPDATE_TIMER",RESET:"RESET",INIT:"@@INIT"}),E=(e=c,t)=>{switch(t.type){case a.APPLY:{const{timePomodoro:o,timeShortBreak:n,timeLongBreak:r,font:i,color:u,letterSpacing:d}=t.payload;return{...e,timePomodoro:o,timeShortBreak:n,timeLongBreak:r,font:i,color:u,letterSpacing:d}}case a.UPDATE_MODE:{const{pomodoroMode:o}=t.payload;return{...e,pomodoroMode:o}}case a.INCREASE_COUNT_POMODORO:return{...e,countPomodoro:e.countPomodoro+1};case a.MAX_COUNT_POMODORO:return{...e,countPomodoro:T};case a.START:{const{totalDuration:o,timeRemaining:n}=t.payload;return{...e,totalDuration:o,timeRemaining:n,isRunning:!0}}case a.STOP:return{...e,isRunning:!1};case a.RESET:return{...e,pomodoroMode:O.POMODORO,countPomodoro:0,totalDuration:25*60,timeRemaining:25*60,breakTime:0,isRunning:!1};case a.UPDATE_TIMER:{const{totalDuration:o,timeRemaining:n,isRunning:r}=t.payload;return{...e,totalDuration:o,timeRemaining:n,isRunning:r}}case a.INIT:return{...S()??structuredClone(e)};default:return e}};function P(e){let t,o=[];const n=()=>Object.freeze(t),r=u=>{t=e(t,u),o.forEach(d=>d())},i=u=>(o.push(u),()=>{o=o.filter(d=>d!==u)});return r({type:"@@INIT"}),{dispatch:r,subscribe:i,getState:n}}const s=P(E),R=(e,{timePomodoro:t,timeShortBreak:o,timeLongBreak:n,font:r,color:i,letterSpacing:u})=>{e.dispatch({type:a.APPLY,payload:{timePomodoro:t??c.timePomodoro,timeShortBreak:o??c.timeShortBreak,timeLongBreak:n??c.timeLongBreak,font:r??c.font,letterSpacing:u??c.letterSpacing,color:i??c.color}})},A=(e,{pomodoroMode:t})=>{e.dispatch({type:a.UPDATE_MODE,payload:{pomodoroMode:t??"pomodoro"}})},g=(e,{totalDuration:t,timeRemaining:o,isPressed:n,isRunning:r})=>{e.dispatch({type:a.UPDATE_TIMER,payload:{totalDuration:t??c.totalDuration,timeRemaining:o??c.timeRemaining,isRunning:r??c.isRunning}})},f=(e,{totalDuration:t,timeRemaining:o})=>{e.dispatch({type:a.START,payload:{totalDuration:t??c.totalDuration,timeRemaining:o??c.timeRemaining}})},D=e=>{e.dispatch({type:a.STOP})},y=e=>{e.dispatch({type:a.RESET})},M=e=>{e.dispatch({type:a.INCREASE_COUNT_POMODORO})},h=e=>{e.dispatch({type:a.MAX_COUNT_POMODORO})};function C(){const e=async()=>{const t=s.getState();p(t)};s.subscribe(e)}function B(e){s.subscribe(()=>e(s)),e(s)}const w=()=>s.getState(),v=({timePomodoro:e,timeShortBreak:t,timeLongBreak:o,color:n,font:r,letterSpacing:i})=>{R(s,{timePomodoro:e,timeShortBreak:t,timeLongBreak:o,font:r,color:n,letterSpacing:i})},X=({pomodoroMode:e})=>{A(s,{pomodoroMode:e})},Y=({totalDuration:e,timeRemaining:t,isRunning:o})=>{g(s,{totalDuration:e,timeRemaining:t,isRunning:o})},$=({totalDuration:e,timeRemaining:t})=>{f(s,{totalDuration:e,timeRemaining:t})},q=()=>{D(s)},K=()=>{y(s)},j=()=>{M(s)},x=()=>{h(s)};export{O as P,b as S,B as a,_ as b,j as c,N as d,$ as e,q as f,w as g,Y as h,C as i,U as j,T as k,v as l,x as m,I as o,L as p,K as r,k as s,X as u};
